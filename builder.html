<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¢„ç®—é…ç½®ç”Ÿæˆå™¨ - åŒ»å­¦ç”Ÿç”µè„‘ç¡¬ä»¶é…ç½®æ¨è</title>
  <meta name="description" content="è¾“å…¥é¢„ç®—ï¼Œä¸€é”®ç”Ÿæˆæœ€é€‚åˆç”Ÿä¿¡ç ”ç©¶çš„ç”µè„‘ç¡¬ä»¶é…ç½®æ–¹æ¡ˆ">
  <link rel="stylesheet" href="css/style.css?v=4">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="index.html" class="nav-brand">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2"/>
            <path d="M8 21h8M12 17v4"/>
          </svg>
          ç”Ÿä¿¡é…ç½®åŠ©æ‰‹
        </a>
        <button class="nav-toggle" onclick="toggleNav()">
          <span></span><span></span><span></span>
        </button>
        <ul class="nav-links" id="navLinks">
          <li><a href="index.html">éœ€æ±‚é€‰æ‹©</a></li>
          <li><a href="cpu.html">CPUè¯„ä»·</a></li>
          <li><a href="gpu.html">GPUè¯„ä»·</a></li>
          <li><a href="builder.html" class="active">é¢„ç®—é…ç½®</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Page Header -->
  <section class="hero" style="padding: 3rem 0;">
    <div class="container">
      <h1>ğŸ› ï¸ é¢„ç®—é…ç½®ç”Ÿæˆå™¨</h1>
      <p>è¾“å…¥ä½ çš„é¢„ç®—å’Œéœ€æ±‚ï¼Œä¸€é”®ç”Ÿæˆæœ€ä¼˜é…ç½®æ–¹æ¡ˆ</p>
    </div>
  </section>

  <!-- Builder Section -->
  <section class="section">
    <div class="container">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        
        <!-- Left: Form -->
        <div class="builder-form">
          <h3 class="mb-3">ğŸ“ é…ç½®å‚æ•°</h3>
          
          <div class="form-group">
            <label for="budget">ğŸ’° æ€»é¢„ç®— (å…ƒ)</label>
            <input type="range" id="budget" min="3000" max="80000" value="10000" step="1000" oninput="updateBudgetDisplay()">
            <div class="range-value">
              <span>Â¥3,000</span>
              <span id="budgetValue" style="font-weight: 700; color: var(--primary-color);">Â¥10,000</span>
              <span>Â¥80,000</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="purpose">ğŸ¯ ä½¿ç”¨åœºæ™¯</label>
            <select id="purpose" onchange="generateConfig()">
              <option value="office">åŠå…¬å­¦ä¹  - ç†Ÿæ‚‰å‘½ä»¤è¡Œã€Officeæ–‡æ¡£</option>
              <option value="entry">å…¥é—¨ç§‘ç ” - Rè¯­è¨€ç»‘å›¾ã€å°ä½“ç§¯æ•°æ®</option>
              <option value="transcriptome" selected>è½¬å½•ç»„åˆ†æ - RNA-seqã€ChIP-seq</option>
              <option value="singlecell">å•ç»†èƒç»„å­¦ - Seuratã€æ·±åº¦å­¦ä¹ </option>
              <option value="genome">åŸºå› ç»„ç»„è£… - de novoã€Hi-C</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="gpuPriority">ğŸ® æ˜¾å¡ä¼˜å…ˆçº§</label>
            <select id="gpuPriority" onchange="generateConfig()">
              <option value="balanced">å‡è¡¡é…ç½®</option>
              <option value="gpu-heavy">æ˜¾å¡ä¼˜å…ˆ (æ·±åº¦å­¦ä¹ /AI)</option>
              <option value="cpu-heavy">CPUä¼˜å…ˆ (å¤šçº¿ç¨‹åˆ†æ)</option>
              <option value="memory-heavy">å†…å­˜ä¼˜å…ˆ (å•ç»†èƒå¤§æ•°æ®)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>
              <input type="checkbox" id="usedGpu" onchange="generateConfig()">
              è€ƒè™‘äºŒæ‰‹æ˜¾å¡ (æ€§ä»·æ¯”æ›´é«˜)
            </label>
          </div>
          
          <button class="btn btn-primary btn-lg" style="width: 100%; margin-top: 1rem;" onclick="generateConfig()">
            ğŸ”„ é‡æ–°ç”Ÿæˆé…ç½®
          </button>
        </div>
        
        <!-- Right: Result -->
        <div>
          <div class="config-result" id="configResult">
            <h3>ğŸ¯ æ¨èé…ç½®</h3>
            <p style="color: var(--text-light);">è°ƒæ•´å·¦ä¾§å‚æ•°åç‚¹å‡»ç”Ÿæˆ</p>
          </div>
          
          <!-- Export Buttons -->
          <div class="flex gap-2 mt-3">
            <button class="btn btn-secondary" onclick="copyConfig()">ğŸ“‹ å¤åˆ¶é…ç½®</button>
            <button class="btn btn-secondary" onclick="shareConfig()">ğŸ”— åˆ†äº«é“¾æ¥</button>
          </div>
        </div>
        
      </div>
    </div>
  </section>

  <!-- Quick Presets -->
  <section class="section" style="background: var(--bg-card);">
    <div class="container">
      <h2 class="text-center mb-4">âš¡ å¿«é€Ÿé¢„è®¾æ–¹æ¡ˆ</h2>
      <div class="card-grid">
        <div class="card" style="cursor: pointer;" onclick="applyPreset('office')">
          <h4>ğŸ“ åŠå…¬å…¥é—¨</h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">Â¥3,500 å·¦å³</p>
          <p style="font-size: 0.8rem; color: var(--text-light);">i3-12100F + æ ¸æ˜¾ + 16GB + 512GB SSD</p>
        </div>
        
        <div class="card" style="cursor: pointer;" onclick="applyPreset('entry')">
          <h4>ğŸ”¬ ç§‘ç ”å…¥é—¨</h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">Â¥5,500 å·¦å³</p>
          <p style="font-size: 0.8rem; color: var(--text-light);">R5 7500F + RTX 3060 + 32GB + 2TB SSD</p>
        </div>
        
        <div class="card" style="cursor: pointer;" onclick="applyPreset('transcriptome')">
          <h4>ğŸ§ª è½¬å½•ç»„ä¸»æµ</h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">Â¥10,800 å·¦å³</p>
          <p style="font-size: 0.8rem; color: var(--text-light);">R9 7900X + RTX 4070S + 64GB + 1TB+4TB</p>
        </div>
        
        <div class="card" style="cursor: pointer;" onclick="applyPreset('singlecell')">
          <h4>ğŸ”® å•ç»†èƒé«˜é…</h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">Â¥25,500 å·¦å³</p>
          <p style="font-size: 0.8rem; color: var(--text-light);">R9 9950X + RTX 4090 + 96GB + 2TB+16TB</p>
        </div>
        
        <div class="card" style="cursor: pointer;" onclick="applyPreset('genome')">
          <h4>ğŸ–¥ï¸ å®éªŒå®¤æœåŠ¡å™¨</h4>
          <p style="color: var(--text-secondary); font-size: 0.875rem;">Â¥70,000+</p>
          <p style="font-size: 0.8rem; color: var(--text-light);">TR 7970X + åŒ4090 + 256GB ECC + NAS</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Component Selection -->
  <section class="section">
    <div class="container">
      <h2 class="text-center mb-4">ğŸ”§ æ‰‹åŠ¨è°ƒæ•´é…ä»¶</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        
        <!-- CPU Selection -->
        <div class="card">
          <h4>ğŸ’» å¤„ç†å™¨ (CPU)</h4>
          <select id="manualCpu" class="form-group" style="width: 100%; margin-top: 1rem;" onchange="updateManualConfig()">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </select>
          <p id="cpuPrice" style="color: var(--secondary-color); font-weight: 500; margin-top: 0.5rem;"></p>
        </div>
        
        <!-- GPU Selection -->
        <div class="card">
          <h4>ğŸ® æ˜¾å¡ (GPU)</h4>
          <select id="manualGpu" class="form-group" style="width: 100%; margin-top: 1rem;" onchange="updateManualConfig()">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </select>
          <p id="gpuPrice" style="color: var(--secondary-color); font-weight: 500; margin-top: 0.5rem;"></p>
        </div>
        
        <!-- Memory Selection -->
        <div class="card">
          <h4>ğŸ§  å†…å­˜ (RAM)</h4>
          <select id="manualMemory" class="form-group" style="width: 100%; margin-top: 1rem;" onchange="updateManualConfig()">
            <option value="16|250">16GB DDR4 - Â¥250</option>
            <option value="32|650" selected>32GB DDR5 (16GÃ—2) - Â¥650</option>
            <option value="64|1300">64GB DDR5 (32GÃ—2) - Â¥1,300</option>
            <option value="96|2200">96GB DDR5 (48GÃ—2) - Â¥2,200</option>
            <option value="128|2800">128GB DDR5 (32GÃ—4) - Â¥2,800</option>
            <option value="256|10000">256GB ECC DDR5 - Â¥10,000</option>
          </select>
          <p id="memoryPrice" style="color: var(--secondary-color); font-weight: 500; margin-top: 0.5rem;"></p>
        </div>
        
        <!-- SSD Selection -->
        <div class="card">
          <h4>ğŸ’¾ å›ºæ€ç¡¬ç›˜ (SSD)</h4>
          <select id="manualSsd" class="form-group" style="width: 100%; margin-top: 1rem;" onchange="updateManualConfig()">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </select>
          <p id="ssdPrice" style="color: var(--secondary-color); font-weight: 500; margin-top: 0.5rem;"></p>
        </div>
        
      </div>
      
      <!-- Manual Total -->
      <div class="config-result mt-4" style="max-width: 600px; margin: 2rem auto 0;">
        <div class="config-total">
          <div class="label">ğŸ’° æ‰‹åŠ¨é…ç½®æ€»ä»· (ä¸å«ä¸»æ¿/ç”µæº/æ•£çƒ­)</div>
          <div class="price" id="manualTotal">Â¥0</div>
        </div>
      </div>
      
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>æ„Ÿè°¢AIçš„æŠ€æœ¯æ”¯æŒï¼Œæ•°æ®æ”¯æŒ Bç«™ï¼›æ‰€æœ‰ä»·æ ¼ä»…ä¾›å‚è€ƒï¼Œå†…å­˜/ç¡¬ç›˜ä»·æ ¼ä¸ºè°ƒä»·å‰</p>
      <p style="margin-top: 0.5rem; font-size: 0.875rem;">
        <a href="index.html">éœ€æ±‚é€‰æ‹©</a> Â· 
        <a href="cpu.html">CPUå¤©æ¢¯</a> Â· 
        <a href="gpu.html">GPUå¤©æ¢¯</a>
      </p>
    </div>
  </footer>

  <!-- åŠ ç‰ˆæœ¬å·é¿å… GitHub Pages / æµè§ˆå™¨ç¼“å­˜æ—§é€»è¾‘ -->
  <script src="js/data.js?v=20251231-4"></script>
  <script>
    // ç§»åŠ¨ç«¯å¯¼èˆªåˆ‡æ¢
    function toggleNav() {
      document.getElementById('navLinks').classList.toggle('active');
    }

    // å½“å‰é…ç½®
    let currentConfig = null;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      initSelects();
      generateConfig();
    });

    // åˆå§‹åŒ–ä¸‹æ‹‰æ¡†
    function initSelects() {
      // CPU
      const cpuSelect = document.getElementById('manualCpu');
      cpuSelect.innerHTML = cpuData
        .filter(c => !c.tier.includes('HEDT') && !c.tier.includes('å·¥ä½œç«™'))
        .sort((a, b) => a.price - b.price)
        .map(c => `<option value="${c.model}|${c.price}">${c.brand} ${c.model} (${c.cores}C/${c.threads}T) - Â¥${c.price.toLocaleString()}</option>`)
        .join('');
      
      // GPU
      const gpuSelect = document.getElementById('manualGpu');
      gpuSelect.innerHTML = '<option value="æ— |0">æ— ç‹¬ç«‹æ˜¾å¡ (æ ¸æ˜¾) - Â¥0</option>' +
        gpuData
          .filter(g => g.model.includes('NVIDIA') && !g.tier.includes('å·¥ä½œç«™'))
          .sort((a, b) => a.price - b.price)
          .map(g => `<option value="${g.model}|${g.price}">${g.model} (${g.vram}GB) - Â¥${g.price.toLocaleString()}</option>`)
          .join('');
      
      // SSD
      const ssdSelect = document.getElementById('manualSsd');
      ssdSelect.innerHTML = ssdData
        .filter(s => s.price < 6000)
        .sort((a, b) => a.price - b.price)
        .map(s => `<option value="${s.model}|${s.price}">${s.model} ${s.capacity} - Â¥${s.price.toLocaleString()}</option>`)
        .join('');
      
      updateManualConfig();
    }

    // æ›´æ–°é¢„ç®—æ˜¾ç¤º
    function updateBudgetDisplay() {
      const budget = document.getElementById('budget').value;
      document.getElementById('budgetValue').textContent = 'Â¥' + parseInt(budget).toLocaleString();
      generateConfig();
    }

    // åº”ç”¨é¢„è®¾
    function applyPreset(type) {
      const presets = {
        office: { budget: 3500, purpose: 'office' },
        entry: { budget: 5500, purpose: 'entry' },
        transcriptome: { budget: 10800, purpose: 'transcriptome' },
        singlecell: { budget: 25500, purpose: 'singlecell' },
        genome: { budget: 70000, purpose: 'genome' }
      };
      
      const preset = presets[type];
      document.getElementById('budget').value = preset.budget;
      document.getElementById('budgetValue').textContent = 'Â¥' + preset.budget.toLocaleString();
      document.getElementById('purpose').value = preset.purpose;
      generateConfig();
      
      // æ»šåŠ¨åˆ°é…ç½®ç»“æœ
      document.getElementById('configResult').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // ç”Ÿæˆé…ç½®
    function generateConfig() {
      const budget = parseInt(document.getElementById('budget').value);
      const purpose = document.getElementById('purpose').value;
      const priority = document.getElementById('gpuPriority').value;
      const useUsed = document.getElementById('usedGpu').checked;
      
      // æ ¹æ®ç”¨é€”ç¡®å®šé¢„è®¾é…ç½®
      const preset = recommendedConfigs[purpose];
      if (!preset) return;
      
      // è®¡ç®—é¢„ç®—æ¯”ä¾‹è°ƒæ•´
      const presetTotal = Object.values(preset.config).reduce((sum, item) => sum + item.price, 0);
      const ratio = budget / presetTotal;
      
      // æ™ºèƒ½é€‰æ‹©é…ä»¶
      let config = {
        cpu: selectBestCPU(budget, purpose, priority, ratio),
        gpu: selectBestGPU(budget, purpose, priority, ratio, useUsed),
        memory: selectBestMemory(budget, purpose, priority, ratio),
        ssd: selectBestSSD(budget, purpose, ratio),
        other: { model: 'ä¸»æ¿+ç”µæº+æ•£çƒ­+æœºç®±', price: 0 }
      };

      // å…³é”®çº¦æŸï¼šå³ä¾§æ€»ä»·å¿…é¡»ä¸é¢„ç®—ä¸€è‡´ï¼ˆé€šè¿‡å›å¡«â€œå…¶ä»–é…ä»¶â€å·®é¢ï¼‰
      reconcileConfigToBudget(budget, config);
      
      currentConfig = config;
      renderConfig(config, purpose);
    }

    function sumCoreParts(config) {
      return (
        (config.cpu?.price || 0) +
        (config.gpu?.price || 0) +
        (config.memory?.price || 0) +
        (config.ssd?.price || 0)
      );
    }

    // å¼ºçº¦æŸï¼šä¿è¯åˆ—è¡¨ä»·æ ¼ä¹‹å’Œ = é¢„ç®—ï¼ˆé€šè¿‡ other å›å¡«ï¼‰
    function reconcileConfigToBudget(budget, config) {
      const partsTotal = sumCoreParts(config);
      config.other.price = Math.max(0, budget - partsTotal);
      // å…œåº•ï¼šç»™æ¸²æŸ“å±‚ä¸€ä¸ªå¯è¯»å­—æ®µ
      config._total = partsTotal + (config.other?.price || 0);
    }

    // é€‰æ‹©æœ€ä½³CPU
    function selectBestCPU(budget, purpose, priority, ratio) {
      // å¼ºåˆ¶è§„åˆ™ï¼šé¢„ç®—æ¥è¿‘/è¶…è¿‡ 8wï¼ˆè¿™é‡ŒæŒ‰ >= 75000 è§†ä¸ºâ€œæ¥è¿‘â€ï¼‰æ—¶ï¼ŒCPU å¿…é¡»ä¸º TR 9980Xï¼ˆÂ¥40000ï¼‰
      if (budget >= 75000) {
        const tr9980x = cpuData.find(c => c.model === 'Threadripper 9980X');
        if (tr9980x) return tr9980x;
      }

      // ç»éªŒè§„åˆ™ï¼šCPU åœ¨ç”Ÿä¿¡åœºæ™¯é‡Œéå¸¸å…³é”®ï¼ˆå¤šçº¿ç¨‹ä»»åŠ¡å¤šï¼‰
      // æ—§é€»è¾‘ CPU å æ¯”åä½ï¼Œå¯¼è‡´é¢„ç®—æé«˜æ—¶ CPU ä¸â€œè·¨æ¡£å‡çº§â€
      let cpuShare = 0.20;
      // é¢„ç®—ä¸Šæ¥åï¼Œå…è®¸ CPU ç›´æ¥è·¨åˆ° 9950X è¿™ç±»æ¡£ä½
      if (budget >= 10000) cpuShare = 0.30;
      if (purpose === 'office') cpuShare = 0.18;
      if (purpose === 'genome') cpuShare = Math.max(cpuShare, 0.28);

      if (priority === 'cpu-heavy') cpuShare += 0.05;
      if (priority === 'gpu-heavy') cpuShare -= 0.08;
      if (priority === 'memory-heavy') cpuShare -= 0.03;

      cpuShare = Math.min(Math.max(cpuShare, 0.12), 0.35);
      const cpuBudget = budget * cpuShare;
      const hardMaxPrice = cpuBudget * 1.10;
      
      // æ ¹æ®ç”¨é€”è®¾ç½®æœ€ä½æ ¸å¿ƒæ•°
      let minCores = 4;
      if (purpose === 'transcriptome') minCores = 8;
      if (purpose === 'singlecell') minCores = 12;
      if (purpose === 'genome') minCores = 24;

      // é¢„ç®—é˜ˆå€¼ä¼˜å…ˆï¼šå…ˆå°è¯•å‘½ä¸­â€œæ¨èæ¡£ä½â€ï¼Œå†å›é€€åˆ°ç®—æ³•æŒ‘é€‰
      const preferredModels = [];
      if (purpose === 'transcriptome') {
        if (budget >= 10000) preferredModels.push('Ryzen 9 9950X', 'Ryzen 9 9950X3D');
        else preferredModels.push('Ryzen 9 7900X', 'i7-14700K', 'i7-14700KF', 'Ryzen 9 9900X');
      } else if (purpose === 'singlecell') {
        preferredModels.push('Ryzen 9 9950X', 'Ryzen 9 9950X3D', 'Ryzen 9 9900X');
      } else if (purpose === 'genome') {
        preferredModels.push('Threadripper 7970X', 'Threadripper 7960X', 'Ryzen 9 9950X');
      } else if (purpose === 'entry') {
        preferredModels.push('i7-14700K', 'i7-14700KF', 'Ryzen 5 7500F', 'i5-14600K');
      } else {
        preferredModels.push('i7-14700K', 'i7-14700KF', 'Ryzen 9 9900X', 'Core Ultra 7 265K');
      }
      // é«˜é¢„ç®—ï¼ˆ>=1wï¼‰é€šç”¨ä¼˜å…ˆï¼š9950X æ¡£ï¼ˆç¬¦åˆä½ æåˆ°çš„é¢„æœŸï¼‰
      if (budget >= 10000) {
        preferredModels.unshift('Ryzen 9 9950X', 'Ryzen 9 9950X3D');
      }

      const preferredHit = preferredModels
        .map(m => cpuData.find(c => c.model === m))
        .find(c => c && c.cores >= minCores && c.price <= hardMaxPrice);
      if (preferredHit) return preferredHit;
      
      const candidates = cpuData
        .filter(c => c.cores >= minCores && c.price <= hardMaxPrice)
        .sort((a, b) => {
          // é¢„ç®—è¶Šé«˜è¶Šåå‘â€œç»å¯¹æ€§èƒ½â€ï¼Œé¢„ç®—è¾ƒä½ä¼˜å…ˆâ€œæ€§ä»·æ¯”â€
          if (budget >= 10000) {
            if (b.score !== a.score) return b.score - a.score;
          }
          const valueA = a.score / a.price;
          const valueB = b.score / b.price;
          return valueB - valueA;
        });
      
      return (
        candidates[0] ||
        cpuData
          .filter(c => c.cores >= minCores && c.price <= cpuBudget * 1.30)
          .sort((a, b) => b.score - a.score)[0] ||
        cpuData[cpuData.length - 1]
      );
    }

    // é€‰æ‹©æœ€ä½³GPU
    function selectBestGPU(budget, purpose, priority, ratio, useUsed) {
      if (purpose === 'office') {
        return { model: 'æ ¸æ˜¾ / äº®æœºå¡', price: 0, vram: 0 };
      }
      
      let gpuBudget = budget * 0.30;
      if (priority === 'gpu-heavy') gpuBudget = budget * 0.45;
      if (priority === 'cpu-heavy') gpuBudget = budget * 0.20;
      
      // æ ¹æ®ç”¨é€”è®¾ç½®æœ€ä½æ˜¾å­˜
      let minVram = 8;
      if (purpose === 'transcriptome') minVram = 12;
      if (purpose === 'singlecell') minVram = 16;
      if (purpose === 'genome') minVram = 24;
      
      // åªé€‰NVIDIA (ç”Ÿä¿¡å¿…é¡»)
      let candidates = gpuData
        .filter(g => 
          g.model.includes('NVIDIA') && 
          g.price <= gpuBudget * 1.2 && 
          g.vram >= minVram &&
          !g.tier.includes('å·¥ä½œç«™')
        )
        .sort((a, b) => {
          // ä¼˜å…ˆå¤§æ˜¾å­˜ï¼Œå…¶æ¬¡æ€§ä»·æ¯”
          if (b.vram !== a.vram) return b.vram - a.vram;
          return (b.score / b.price) - (a.score / a.price);
        });
      
      // å¦‚æœé¢„ç®—ä¸å¤Ÿï¼Œé™ä½æ˜¾å­˜è¦æ±‚
      if (candidates.length === 0) {
        candidates = gpuData
          .filter(g => g.model.includes('NVIDIA') && g.price <= gpuBudget * 1.5)
          .sort((a, b) => b.vram - a.vram);
      }
      
      return candidates[0] || { model: 'RTX 3060 12G', price: 1382, vram: 12 };
    }

    // é€‰æ‹©æœ€ä½³å†…å­˜
    function selectBestMemory(budget, purpose, priority, ratio) {
      let memBudget = budget * 0.10;
      if (priority === 'memory-heavy') memBudget = budget * 0.18;
      
      // æ ¹æ®ç”¨é€”ç¡®å®šå®¹é‡
      let capacity = '16GB';
      let price = 250;
      
      if (purpose === 'entry' || budget >= 5000) { capacity = '32GB'; price = 650; }
      if (purpose === 'transcriptome' || budget >= 9000) { capacity = '64GB'; price = 1300; }
      if (purpose === 'singlecell' || budget >= 18000) { capacity = '96GB'; price = 2200; }
      if (purpose === 'genome' || budget >= 50000) { capacity = '256GB ECC'; price = 10000; }
      
      // é¢„ç®—ä¸å¤Ÿåˆ™é™çº§
      while (price > memBudget * 1.5 && price > 250) {
        if (capacity === '256GB ECC') { capacity = '128GB'; price = 2800; }
        else if (capacity === '128GB') { capacity = '96GB'; price = 2200; }
        else if (capacity === '96GB') { capacity = '64GB'; price = 1300; }
        else if (capacity === '64GB') { capacity = '32GB'; price = 650; }
        else { capacity = '16GB'; price = 250; break; }
      }
      
      return { model: capacity + ' DDR5', price: price, capacity: capacity };
    }

    // é€‰æ‹©æœ€ä½³SSD
    function selectBestSSD(budget, purpose, ratio) {
      // è§„åˆ™ï¼ˆä½ æå‡ºçš„ç¡¬çº¦æŸï¼‰ï¼š
      // - ä»»æ„åœºæ™¯ï¼š<=10000 ç”¨ TiPlus 7100 2TBï¼›>10000 ç”¨ 990 Pro 2TBï¼›>=30000 ç”¨ 9100 Pro 2TB
      // - è½¬å½•ç»„åŠå•ç»†èƒä»¥ä¸Šï¼šSSD è‡³å°‘ 4TBï¼ˆå¹¶æŒ‰åŒæ¡£ä½é€‰æ‹© 4TB å‹å·ï¼‰
      const needAtLeast4TB = (purpose === 'transcriptome' || purpose === 'singlecell' || purpose === 'genome');

      let targetModel = 'è‡´æ€ TiPlus 7100';
      let targetCapacity = needAtLeast4TB ? '4TB' : '2TB';

      if (budget > 10000) {
        targetModel = 'ä¸‰æ˜Ÿ 990 Pro';
        targetCapacity = needAtLeast4TB ? '4TB' : '2TB';
      }
      if (budget >= 30000) {
        targetModel = 'ä¸‰æ˜Ÿ 9100 Pro';
        targetCapacity = needAtLeast4TB ? '4TB' : '2TB';
      }

      // åœ¨æ•°æ®ä¸­æ‰¾å¯¹åº”æ¡ç›®
      const exact = ssdData.find(s => s.model === targetModel && s.capacity === targetCapacity);
      if (exact) return exact;

      // è‹¥æ²¡æœ‰ 4TB å¯¹åº”å‹å·ï¼Œå›é€€åˆ°â€œä»»æ„ 4TBâ€é‡Œæœ€æ¥è¿‘çš„
      if (needAtLeast4TB) {
        const any4tb = ssdData.filter(s => s.capacity === '4TB').sort((a, b) => a.price - b.price);
        if (any4tb[0]) return any4tb[0];
      }

      // æœ€ç»ˆå…œåº•ï¼šæŒ‰é¢„ç®—ä»ä½åˆ°é«˜é€‰æ‹©
      const ssdBudget = budget * 0.12;
      const candidates = ssdData
        .filter(s => s.price <= ssdBudget * 1.5)
        .sort((a, b) => b.read4k - a.read4k);
      return candidates[0] || { model: 'è‡´æ€ TiPlus 7100', capacity: '1TB', price: 499, read4k: 32.5 };
    }

    // æ³¨ï¼šæ—§ç‰ˆ estimateOtherCost å·²å¼ƒç”¨ï¼ˆæ”¹ä¸ºè‡ªåŠ¨å›å¡«å·®é¢ï¼Œä¿è¯æ€»ä»·=é¢„ç®—ï¼‰

    // æ¸²æŸ“é…ç½®
    function renderConfig(config, purpose) {
      const result = document.getElementById('configResult');
      const purposeNames = {
        office: 'åŠå…¬å­¦ä¹ ',
        entry: 'å…¥é—¨ç§‘ç ”',
        transcriptome: 'è½¬å½•ç»„åˆ†æ',
        singlecell: 'å•ç»†èƒç»„å­¦',
        genome: 'åŸºå› ç»„ç»„è£…'
      };
      
      const budget = parseInt(document.getElementById('budget').value);
      const total = (config._total ?? ((config.cpu?.price || 0) +
                    (config.gpu?.price || 0) +
                    (config.memory?.price || 0) +
                    (config.ssd?.price || 0) +
                    (config.other?.price || 0)));
      const diff = budget - total;
      
      result.innerHTML = `
        <h3>ğŸ¯ ${purposeNames[purpose]} - æ™ºèƒ½æ¨è</h3>
        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
          é¢„ç®—ï¼šÂ¥${budget.toLocaleString()}${diff === 0 ? 'ï¼ˆå·²å¯¹é½ï¼‰' : `ï¼ˆå·®é¢ï¼šÂ¥${diff.toLocaleString()}ï¼‰`}
        </p>
        
        <div class="config-item">
          <div class="label">
            <div class="icon">ğŸ’»</div>
            <div>
              <div class="model">${config.cpu?.brand || ''} ${config.cpu?.model || 'å¾…é€‰'}</div>
              <div class="spec">${config.cpu?.cores || 0}æ ¸${config.cpu?.threads || 0}çº¿ç¨‹ | R23: ${(config.cpu?.score || 0).toLocaleString()}</div>
            </div>
          </div>
          <div class="price">Â¥${(config.cpu?.price || 0).toLocaleString()}</div>
        </div>
        
        <div class="config-item">
          <div class="label">
            <div class="icon">ğŸ®</div>
            <div>
              <div class="model">${config.gpu?.model || 'å¾…é€‰'}</div>
              <div class="spec">${config.gpu?.vram ? config.gpu.vram + 'GB æ˜¾å­˜' : 'æ— ç‹¬æ˜¾'}</div>
            </div>
          </div>
          <div class="price">Â¥${(config.gpu?.price || 0).toLocaleString()}</div>
        </div>
        
        <div class="config-item">
          <div class="label">
            <div class="icon">ğŸ§ </div>
            <div>
              <div class="model">${config.memory?.model || 'å¾…é€‰'}</div>
              <div class="spec">å†…å­˜</div>
            </div>
          </div>
          <div class="price">Â¥${(config.memory?.price || 0).toLocaleString()}</div>
        </div>
        
        <div class="config-item">
          <div class="label">
            <div class="icon">ğŸ’¾</div>
            <div>
              <div class="model">${config.ssd?.model || 'å¾…é€‰'} ${config.ssd?.capacity || ''}</div>
              <div class="spec">4Kè¯»å–: ${config.ssd?.read4k || '-'} MiB/s</div>
            </div>
          </div>
          <div class="price">Â¥${(config.ssd?.price || 0).toLocaleString()}</div>
        </div>
        
        <div class="config-item">
          <div class="label">
            <div class="icon">ğŸ”§</div>
            <div>
              <div class="model">${config.other?.model || 'å…¶ä»–é…ä»¶'}</div>
              <div class="spec">é¢„ä¼°è´¹ç”¨</div>
            </div>
          </div>
          <div class="price">Â¥${(config.other?.price || 0).toLocaleString()}</div>
        </div>
        
        <div class="config-total">
          <div class="label">ğŸ’° é¢„ä¼°æ€»ä»·</div>
          <div class="price">Â¥${total.toLocaleString()}</div>
        </div>
      `;
    }

    // æ›´æ–°æ‰‹åŠ¨é…ç½®
    function updateManualConfig() {
      const cpu = document.getElementById('manualCpu').value.split('|');
      const gpu = document.getElementById('manualGpu').value.split('|');
      const memory = document.getElementById('manualMemory').value.split('|');
      const ssd = document.getElementById('manualSsd').value.split('|');
      
      const total = parseInt(cpu[1] || 0) + parseInt(gpu[1] || 0) + parseInt(memory[1] || 0) + parseInt(ssd[1] || 0);
      
      document.getElementById('cpuPrice').textContent = 'Â¥' + parseInt(cpu[1] || 0).toLocaleString();
      document.getElementById('gpuPrice').textContent = 'Â¥' + parseInt(gpu[1] || 0).toLocaleString();
      document.getElementById('memoryPrice').textContent = 'Â¥' + parseInt(memory[1] || 0).toLocaleString();
      document.getElementById('ssdPrice').textContent = 'Â¥' + parseInt(ssd[1] || 0).toLocaleString();
      document.getElementById('manualTotal').textContent = 'Â¥' + total.toLocaleString();
    }

    // å¤åˆ¶é…ç½®
    function copyConfig() {
      if (!currentConfig) {
        alert('è¯·å…ˆç”Ÿæˆé…ç½®');
        return;
      }
      
      const purpose = document.getElementById('purpose').value;
      const purposeNames = {
        office: 'åŠå…¬å­¦ä¹ ',
        entry: 'å…¥é—¨ç§‘ç ”',
        transcriptome: 'è½¬å½•ç»„åˆ†æ',
        singlecell: 'å•ç»†èƒç»„å­¦',
        genome: 'åŸºå› ç»„ç»„è£…'
      };
      
      const total = (currentConfig.cpu?.price || 0) + 
                    (currentConfig.gpu?.price || 0) + 
                    (currentConfig.memory?.price || 0) + 
                    (currentConfig.ssd?.price || 0) +
                    (currentConfig.other?.price || 0);
      
      const text = `ã€ç”Ÿä¿¡é…ç½®åŠ©æ‰‹ - ${purposeNames[purpose]}ã€‘
CPU: ${currentConfig.cpu?.brand || ''} ${currentConfig.cpu?.model || ''} - Â¥${currentConfig.cpu?.price || 0}
GPU: ${currentConfig.gpu?.model || 'æ— '} - Â¥${currentConfig.gpu?.price || 0}
å†…å­˜: ${currentConfig.memory?.model || ''} - Â¥${currentConfig.memory?.price || 0}
SSD: ${currentConfig.ssd?.model || ''} - Â¥${currentConfig.ssd?.price || 0}
å…¶ä»–: ${currentConfig.other?.model || ''} - Â¥${currentConfig.other?.price || 0}
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
æ€»ä»·: Â¥${total.toLocaleString()}`;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      }).catch(() => {
        // é™çº§æ–¹æ¡ˆ
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      });
    }

    // åˆ†äº«é…ç½®
    function shareConfig() {
      const budget = document.getElementById('budget').value;
      const purpose = document.getElementById('purpose').value;
      const url = window.location.origin + window.location.pathname + 
                  `?budget=${budget}&purpose=${purpose}`;
      
      navigator.clipboard.writeText(url).then(() => {
        alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼');
      }).catch(() => {
        prompt('å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ†äº«ï¼š', url);
      });
    }

    // ä»URLå‚æ•°æ¢å¤é…ç½®
    (function() {
      const params = new URLSearchParams(window.location.search);
      const budget = params.get('budget');
      const purpose = params.get('purpose');
      
      if (budget) {
        document.getElementById('budget').value = budget;
        document.getElementById('budgetValue').textContent = 'Â¥' + parseInt(budget).toLocaleString();
      }
      if (purpose) {
        document.getElementById('purpose').value = purpose;
      }
    })();
  </script>
</body>
</html>
